id: AUV-0005
title: Checkout validation & submit
owner: web
status: active
tags: [ui, api, checkout, forms]

acceptance:
  summary: >
    Users can fill a checkout form (name, email, address, card) with inline validation.
    API accepts POST /checkout and returns { orderId } when payload is valid.

requirements:
  api:
    - POST /api/checkout -> 201 { orderId } on valid; 400 { error } on invalid
  ui:
    - /checkout.html renders form with data-testids:
        - name: #name, email: #email, address: #address, card: #card
        - submit: [data-testid="submit-order"]
        - errors inline: [data-testid="error-<field>"]
        - success banner: [data-testid="order-success"]

tests:
  playwright:
    - tests/robot/playwright/checkout.spec.ts
  api:
    - tests/robot/playwright/api/checkout.spec.ts

artifacts:
  required:
    - runs/AUV-0005/ui/checkout_success.png
    - runs/AUV-0005/perf/lighthouse.json

authoring_hints:
  ui:
    page: /checkout.html
    submit_selector: '[data-testid="submit-order"]'
    success_selector: '[data-testid="order-success"]'
    screenshot: 'checkout_success.png'
  api:
    base_path: /checkout
    cases:
      - name: valid -> 201
        method: POST
        body:
          name: 'Jane'
          email: 'jane@example.com'
          address: '1 Test St'
          card: '4242424242424242'
        expect_status: 201

# Phase 6: Performance budgets
perf_budgets:
  lcp_ms: 2500     # Largest Contentful Paint
  tti_ms: 3800     # Time to Interactive
  cls: 0.1         # Cumulative Layout Shift
  fcp_ms: 1800     # First Contentful Paint
  tbt_ms: 200      # Total Blocking Time
  si_ms: 3400      # Speed Index
  score: 0.9       # Overall performance score

# Phase 6: Visual regression
visual:
  routes:
    - id: checkout-form
      page: /checkout.html
      fullPage: true
      threshold:
        pixel_pct: 0.1  # Allow up to 0.1% pixel difference
      hideSelectors: []  # No dynamic elements to hide

# Phase 6: Security requirements
security:
  required: true
  scan_on_change: true
