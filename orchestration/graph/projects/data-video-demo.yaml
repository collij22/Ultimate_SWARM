version: '1.0'
project_id: data-video-demo
concurrency: 3
defaults:
  retries:
    max: 1
    backoff_ms: 1000
  timeout_ms: 180000
nodes:
  - id: server
    type: server
    resources: [server]

  - id: ingest
    type: agent_task
    params:
      capability: data.ingest

  - id: insights
    type: agent_task
    requires: [ingest]
    params:
      capability: data.insights

  - id: chart
    type: agent_task
    requires: [insights]
    params:
      capability: chart.render

  - id: tts
    type: agent_task
    requires: [insights]
    params:
      capability: audio.tts
      # Provide a short dynamic script so TTS has real content
      text: 'Quarterly sales summary: Electronics leads, followed by Furniture and Office Supplies. Average order value and regional distribution are included in this report.'

  - id: video
    type: agent_task
    requires: [chart, tts]
    params:
      capability: video.compose

  - id: demo_runbook
    type: demo_runbook
    requires: [video]
    params:
      auv: AUV-1201
      steps: ['data.ingest', 'data.insights', 'chart.render', 'audio.tts', 'video.compose']
      force: true

  - id: package
    type: package
    requires: [demo_runbook]
    params:
      auv: AUV-1201

  - id: report
    type: report
    requires: [package]
    params:
      auv: AUV-1201
edges:
  - [server, ingest]
  - [ingest, insights]
  - [insights, chart]
  - [insights, tts]
  - [chart, video]
  - [tts, video]
  - [video, demo_runbook]
  - [demo_runbook, package]
  - [package, report]
